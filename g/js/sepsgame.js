
var gameAbi = [{"constant":false,"inputs":[],"name":"changeBackOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"changeNewOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"joinGame","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"parent","type":"address"}],"name":"setShareParent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"startGame","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdrawReward","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdrawShareReward","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"constant":true,"inputs":[],"name":"_owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"_sepsreciver","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"cycle","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"gameTimes","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getParent","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getShareParent","outputs":[{"name":"","type":"address"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getUserData","outputs":[{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getUserDataV1","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getUserLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oneTokenAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"outAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"overIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"poolAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"rewardOneAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"REWARDTOKEN","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"shareAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}];
var tokenAbi=[{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"}],"name":"sysDsale","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"}],"name":"removeWhiteList","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"sender","type":"address"},{"name":"recipient","type":"address"},{"name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"_swap","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"value","type":"uint256"}],"name":"burn","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"}],"name":"sysAsale","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"isInWhiteList","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"exchangeStop","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"t","type":"address"},{"name":"amount","type":"uint256"}],"name":"withdrawToken","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"recipient","type":"address"},{"name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"}],"name":"setSwap","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"_root","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"exchange","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"user","type":"address"}],"name":"addWhiteList","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"}];
var gasPrice='5000000000';
var tokenTokenContract='0x7B2256844e6262c01Ef0bC38a2B0772D109E11Da';
var controlContract = '0xE5fD5F55A9E6c00c74da4a004a5C7bD2477B5F91';
var linkMyWallet=function(){if(ethereum){web3Provider=ethereum;try{ethereum.enable();}catch(error){tishi("user cancel");return;}}else if(web3){web3Provider=web3.currentProvider;console.log("web3.currentProvider:");}else{web3Provider=new Web3.providers.HttpProvider('http://localhost:8545');console.log("https://http-testnet.hecochain.com");}web3js=new Web3(web3Provider);}
var selectAddress;
var web3jsInit=function(){var Inval=setInterval(function(){linkMyWallet();if(web3js){web3js.eth.getAccounts(function(error,result){if(!error){selectAddress=result[0];contractInstanceInit();window.clearInterval(Inval);}});}},2000);}
web3jsInit();
var tokenContractInstance;
var controlContractInstance;
var contractInstanceInit=function(){
	// dataContractInit();  è¢«ææ³¨éæäº
	controlContractInstance=new web3js.eth.Contract(gameAbi,controlContract,{from:selectAddress,gasPrice:'0'});
	tokenContractInstance=new web3js.eth.Contract(tokenAbi,tokenTokenContract,{from:selectAddress,gasPrice:'0'});
	pageDataInit();
}

//å¬å±é¨å
var approve = function(backFunction,errorFunction){tokenContractInstance.methods.approve(controlContract,'99999999999900000000').send({from:selectAddress,gasPrice: gasPrice},errorFunction).then(backFunction);}
var setShareParent=function(parentAddress,backFunction,errorFunction){controlContractInstance.methods.setShareParent(parentAddress).send({from:selectAddress,gasPrice:gasPrice},errorFunction).then(backFunction);}

//ä¿®æ¹é¨å(å¼å§ï¼æåå¥å±2ä¸ªï¼éæ°å¼å§æ¸¸æ)
var startGame=function(backFunction,errorFunction){controlContractInstance.methods.startGame().send({from:selectAddress,gasPrice:gasPrice},errorFunction).then(backFunction);}
var joinGame=function(backFunction,errorFunction){controlContractInstance.methods.joinGame().send({from:selectAddress,gasPrice:gasPrice},errorFunction).then(backFunction);}
var withdrawReward=function(backFunction,errorFunction){controlContractInstance.methods.withdrawReward().send({from:selectAddress,gasPrice:gasPrice},errorFunction).then(backFunction);}
var withdrawShareReward=function(backFunction,errorFunction){controlContractInstance.methods.withdrawShareReward().send({from:selectAddress,gasPrice:gasPrice},errorFunction).then(backFunction);}

//æ¥è¯¢é¨å
var getallowance=function(backFunction){tokenContractInstance.methods.allowance(selectAddress,controlContract).call({from:selectAddress,gasPrice:'0'}).then(backFunction);}
var getShareParent=function(backFunction){controlContractInstance.methods.getShareParent(selectAddress).call({from:selectAddress,gasPrice:'0'}).then(backFunction);}

//æ¥è¯¢ç¨æ·æ°æ®
var getUserData=function(backFunction){controlContractInstance.methods.getUserData(selectAddress).call({from:selectAddress,gasPrice:'0'}).then(backFunction);}
var getUserDataV1=function(backFunction){controlContractInstance.methods.getUserDataV1(selectAddress).call({from:selectAddress,gasPrice:'0'}).then(backFunction);}
var gameTimes = function(backFunction){controlContractInstance.methods.gameTimes().call({from:selectAddress,gasPrice:'0'}).then(backFunction);}


//é¡µé¢åå§å
var pageDataInit = function(){
	getallowance(function(res){
		if(res*1>1000000000){
			alert('ä¸ç¨å¼¹åºåä¸çªå£ææé®');
		}else{
			//å¿é¡»åä¸ä¹åæå¯ä»¥ï¼è¿æ¯ä¸åçåºç¡
			alert('å¼¹åºåä¸çªå£ææé®');
		}
	})
}

//åä¸å¬çæ¸¸æç¬¬ä¸é¨éè¦ååä¸åä¹åçèªè¡è½¦æ¸¸ææ¯ä¸æ ·ç
var approveTest = function(){
	approve(function(res){},function(res){})
}


//æ¥è¯¢æçæ¨èäººï¼æçç´æ¨äººæ°
var getShareParentTest = function(){
	getShareParent(function(res){
		console.log(res)
	})
}
//è®¾ç½®æ¨èäºº(åä¹åèªè¡è½¦æ¸¸æä¸æ ·)
var setShareParentTest = function(){
	//ç¬¬ä¸ä¸ªå°åæ¯ç¨æ·è¾å¥çæ¨èäººé±åå°å
	console.log('setShareParentTest')
	setShareParent('0xcB80e5f5A75840e0A5a2d4A30606733Ec50129aa',function(res){
		console.log(res)
	},function(error,info){
		if(error){
			console.log(error)//æç¤ºç¨æ·åæ¶
		}else{
			console.log(info)//æç¤ºç¨æ·åæ¶
		}
	})
}

//éæ°å¼å§ï¼åªæè¶æ¶ä»¥åæå¯ä»¥ç¹å»ï¼ä»æ°å¼å§
var startGameTest = function(){
	startGame(function(res){
		
	},function(res){
		
	})
}

//åä¸å¬çæ¸¸æï¼æèµ100ä¸ªsepsï¼ä¸éè¦åæ°
var joinGameTest = function(){
	joinGame(function(res){
		
	},function(res){
		
	})
}

//æåå¬çåºå±å¥å±ï¼ä¸éè¦åæ°
var withdrawRewardTest = function(){
	withdrawReward(function(res){
		
	},function(res){
		
	})
}

//æåæ¨èå¥å±ï¼ä¸éè¦åæ°
var withdrawShareRewardTest = function(){
	withdrawShareReward(function(res){
		
	},function(res){
		
	})
}

/**
 * æ¥è¯¢æ°æ®é¨å
 */

var gameTimesTest = function(){
	gameTimes(function(res){
		//æ¸¸ææ¬¡æ°ï¼åå§åæ¯1ï¼å½è¿ç»­çå¨æåæ²¡æäººåä¸ç»æåï¼å¼å§ä¸ä¸æ¬¡ï¼è¿ä¸ªæ°æ®ä¼ç´¯å ï¼è°ç¨startGameæ¥å£ä¼ç´¯å ï¼
	})
}


var getUserDataTest = function(){
	getUserData(function(res){
		//1ï¼æ¨èäºº
		//2ï¼ææä¿¡æ¯ï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼ï¼å¤§äºæ¯æ¬¡åä¸æ°éï¼æå¯ä»¥åä¸æ¸¸æï¼å¦åéè¦åè°ç¨apporveæ¥å£
		//3, ç´¯è®¡åä¸sepsæ°éï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
		//4, ç´¯è®¡åäº«å¥å±sepsæ°éï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
		//5, ç´¯è®¡æååäº«å¥å±sepsæ°éï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
	})
}

var getUserDataV1Test = function(){
	getUserDataV1(function(res){
		//1ï¼æ¬è½®åä¸çæ»äººæ°
		//2ï¼æ­£å¨åºå±ç¬¬å ä¸ªäººæèç¬¬å ä¸ªäººåååºå±å®æ
		//3, æåä¸æ¬¡åä¸çæ¶é´ï¼åä½ç§)ç¨æ¥åå§ååè®¡æ¶
		//4, ç´¯è®¡å¥å±æ± éé¢ï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
		//5, ç´¯è®¡å¬çå¥å±sepsæ°éï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
		//6, ç´¯è®¡å¬çå¥å±æåçsepsæ°éï¼éè¦é¤ä»¥1åé¢18ä¸ª0ï¼
	})
}